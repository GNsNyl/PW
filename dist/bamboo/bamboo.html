<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>The Wicker Basket, Bamboo, and K-line</title>
  <style>
    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: Arial;
      color: white;
      overflow-x: hidden;
    }
    .p2{
      font-family: Arial;
      color: black;
      overflow-x: hidden;
    }

    .split {
      height: 100%;
      width: 50%;
      position: fixed;
      z-index: 1;
      top: 0;
      overflow-x: hidden;
      padding-top: 20px;
    }
    
    .left {
      left: 0;
      background-color: rgb(0, 0, 0);
      display: flex;
      overflow-x: hidden;
      overflow-y: scroll;
    }
    .main_text {
      margin-top: 25vh;
      position:absolute;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    
    .right {
      right: 0;
      width: 50%;
      background: none;
      position: absolute;
      overflow-x:hidden;
      overflow-y: scroll;
    }
    canvas{
      height: 100%;
      position:fixed;
    }
    
    .centered {
      position: relative;
        width: 25vw;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    
    .centered img {
      width: 150px;
      border-radius: 50%;
    }
    .placeholder{
      height: 100vh;
      margin-top: 100vh;
    }

    #img1{
      width: 100px;
      /* top: 75%; */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    iframe{
      frameborder: 0px;
      /*display: flow;*/
      /*margin-top: 20px;*/
      border: 0px;
      alignment: center;
      width: 30vw;
      height:80vh;
      position: relative;
      margin: 5vw;
    }
    section{
      margin-top: 50vh;
    }
    #container{
      right: 0;
      width: 50%;
      height: 100%;
      z-index: 1;
      position: fixed;
      /* overflow-y: hidden;
      overflow-x: hidden; */
      position: fixed;
      top: 0;
      /* display: block; */
    }
    .scrool{
      position: fixed;
      overflow-y: scroll;
    }
    /* section{
      margin-top: 100vmax;
    } */
    h4 {
      font-family: "Times New Roman", Times, serif;
      font-size: small;
      font-style: italic;
    }
    #data_container{
      right: 0;
      color: black;
      width: 50%;
      height: 100%;
      z-index: 2;
      position: absolute;
      /* overflow-y: hidden;
      overflow-x: hidden; */
      top: 0;
      /* display: block; */
    }
    #term_container{
        /*width: 30vw;*/
        font-size: x-small;
        font-family: "Andale Mono";
    }
    .line {
        fill: none;
        stroke-width: 1px;
    }

    .axis path {
        stroke: black;
        stroke-width: 2px;
        fill: none;
        shape-rendering: crispEdges;
    }

    .tick line {
        stroke: black;
        stroke-width: 2px;
    }
    </style>
  <!-- <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="./app.js"></script> -->
</head>
<body>
  
  <main>

    <div class="split left">
      <div class="centered main_text">
        <h2>The Wicker Basket, Bamboo, and K-line:
          </h2>
        <h3>“market” economy and carbon trading in rural China</h3>
        <h4>In memory of my grandma,<br> 
          wife to a Chinese teacher, illiterate,<br> 
          mother of 4 children, peasant,<br> 
          had the strength to shoulder a tree,<br> 
          fighted lung cancer for 16 years, <br> 
          passed away as the autumn of 2022 fell.<br> 
          It’s a Chinese tradition to be buried in the land where one was born,<br> 
          in her case, to the soil she married.
        </h4>
<!--      </div>-->
<!--      <div class="main_text">-->
          <section>
        <p>Grandma died, on the other side of the earth. I thought I was blessed with the gift of distance, from the affective display of sorrow, until it occurred to me that my silence and tears were only some coping reticence against my shame of not having memorized those minutes I’d spent with her.</p>
        <p>Like flying a kite, I am holding tight to one side just not to lose the other, no sight of the middle: at the immediate side of the coil is the memory of her pale face, gasping, on my phone screen; and far, those years of the 2000’s. But far is all I’ve wanted. </p>
        <h5>Year two Thousand Something, the Wicker Basket and Mushroom Economy:</h5>
        <p>
          I spent my early summer and winter breaks in small villages with my grandparents, powering up by doing nothing. We lived in the northern part of inland China. Thanks to the mountainous topography, we got about ten-minute heavy rain almost every day, and the sky cleared up for the rest of the day. This is the perfect condition for mushroom prosperity: humid enough for its growth, and gentle, so that it is not washed away. Grandma would get in the forest and collect mushrooms every other day, I could tag along if I felt like it. All the time, she carried an empty wicker basket, spacious enough to put me inside, and got back a basket full of mushrooms, hazelnuts, and some unnamed grasses. Risking overgeneralization, the most common “wall decoration” in northern rural China was those handcrafted wicker baskets, of various sizes, weathered. I don’t see them often today any more. Made absolutely devoid by material and structural mechanics, in the hands of my grandma, they seemed steady enough to carry the mountain. After not very long, I earned myself a mini-basket for participation award; happily, I became “well” equipped to collect. 
        </p>
        <p>
          The newly collected mushrooms have to be cleaned and flatted under the sun to avoid molding. depending on the weather conditions, but most often after two or three weeks, we would bag them to sell. Different varieties of mushrooms sold at different prices, for me, this wasn’t given knowledge back then. I learned at the “business negotiation table.” There had always been men on a motorcycle, traveling miles across villages to buy mushrooms, hazelnuts, etc… I called them the “mushroom brokers.” 
        </p>
        <p>
          That was almost 20 years ago, a gunny sack of mushrooms from a month’ labor, compact, of my height, could only sell 30 Yuan (about $4.5). That was already the price after haggling. From their “dance” of negotiation, I learned about the yield and rainfall, price and temperature. The mushroom broker came already burdening the motorcycle, but always managed to make space for grandma’s bloated bags. Grandma was illiterate but could do math, however she made sure that I was always around, in case her untrained math skills failed her at the critical points.
        </p>
        <p>I lived in the city most of the year, but never had I been so close to the “market” while I was in the distant village, assisting grandma to sell mushrooms. Many years later, I learned the term “invisible hands of the market” in junior high politics class. At that time, the “hand” was talking through the broker’s mouth, about words he probably had picked up from other merchants, and handed grandma the compensation for the summers’ labor.
        </p>
        <p>One thing important is that you don’t sell mushrooms to make a living, the mountain was not generous enough to have that many mushrooms to support the entire family. Grandparents live off the modest income as a teacher and their rice and corn field. Collecting mushrooms was only to fill in what was meant to be a recessive season of the year – in between spring sowing-seeding and fall harvesting. 
         </p>
          </section>

    </div>


    </div>
    <div class="right">
      <section class="placeholder"></section>
      <section class="placeholder"></section>
      <section class="placeholder"></section>
      <section class="placeholder"></section>
    </div>
      
  </main>

  <div id="container">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r125/three.min.js'></script>
    <script  src="./bamboo.js"></script>
  </div>

  <div id="data_container">
    <section>
    </section>
    <section>
    </section>

    <section>

    </section>
    <section>
    </section>
    <section>
    </section>
    <section>

    </section>


    <section id="term_container">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
      <script>
        // basic SVG setup
        var margin = { top: 20, right: 150, bottom: 40, left: 100 };
        var height = 350 - margin.top - margin.bottom;
        var width = 650 - margin.left - margin.right;

        var svg = d3.select("#term_container").append("svg")
                .attr("width",width + margin.left + margin.right)
                .attr("height",height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // setup scales - the domain is specified inside of the function called when we load the data
        var xScale = d3.time.scale().range([0, width]);
        var yScale = d3.scale.linear().range([height, 0]);
        // var color = 'black';
        var color = d3.scale.category10();

        // setup the axes
        var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
        var yAxis = d3.svg.axis().scale(yScale).orient("left");

        // create function to parse dates into date objects
        var parseDate = d3.time.format("%Y-%m").parse;
        var formatDate = d3.time.format("%Y-%m");
        var bisectDate = d3.bisector(function(d) { return d.date; }).left;

        // set the line attributes
        var line = d3.svg.line()
                .interpolate("basis")
                .x(function(d) { return xScale(d.date); })
                .y(function(d) { return yScale(d.close); });

        var focus = svg.append("g").style("display","none");

        // import data and create chart
        d3.csv("files/term_world.csv", function(d) {
                  return {
                    date: parseDate(d.date),
                    Carbon_emission_trading: +d.Carbon_emission_trading,
                    Carbon_trade: +d.Carbon_trade,
                    Payment_for_ecosystem_services: +d.Payment_for_ecosystem_services,
                    Carbon_tax: +d.Carbon_tax,

                  };
                },
                function(error,data) {

                  // sort data ascending - needed to get correct bisector results
                  data.sort(function(a,b) {
                    return a.date - b.date;
                  });

                  // color domain
                  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "date"; }));

                  // create stocks array with object for each company containing all data
                  var stocks = color.domain().map(function(name) {
                    return {
                      name: name,
                      values: data.map(function(d){
                        return {date: d.date, close: d[name]};
                      })
                    };
                  });

                  // add domain ranges to the x and y scales
                  xScale.domain([
                    d3.min(stocks, function(c) { return d3.min(c.values, function(v) { return v.date; }); }),
                    d3.max(stocks, function(c) { return d3.max(c.values, function(v) { return v.date; }); })
                  ]);
                  yScale.domain([
                    0,
                    // d3.min(stocks, function(c) { return d3.min(c.values, function(v) { return v.close; }); }),
                    d3.max(stocks, function(c) { return d3.max(c.values, function(v) { return v.close; }); })
                  ]);

                  // add the x axis
                  svg.append("g")
                          .attr("class", "x axis")
                          .attr("transform", "translate(0," + height + ")")
                          .call(xAxis);

                  // add the y axis
                  svg.append("g")
                          .attr("class", "y axis")
                          .call(yAxis)
                          .append("text")
                          .attr("transform","rotate(-90)")
                          .attr("y",-60)
                          .attr("dy",".71em")
                          .style("text-anchor","end")
                          .text("count");

                  // add circle at intersection
                  focus.append("circle")
                          .attr("class","y")
                          .attr("fill","none")
                          .attr("stroke","black")
                          .style("opacity",0.5)
                          .attr("r",8);

                  // add horizontal line at intersection
                  focus.append("line")
                          .attr("class","x")
                          .attr("stroke","black")
                          .attr("stroke-dasharray","3,3")
                          .style("opacity",0.5)
                          .attr("x1", 0)
                          .attr("x2", width);

                  // add vertical line at intersection
                  focus.append("line")
                          .attr("class","y")
                          .attr("stroke","black")
                          .attr("transition-duration","1s")
                          .attr("stroke-dasharray","3,3")
                          .style("opacity",0.5)
                          .attr("y1", 0)
                          .attr("y2", height);

                  // append rectangle for capturing if mouse moves within area
                  svg.append("rect")
                          .attr("width",width)
                          .attr("height",height)
                          .style("fill","none")
                          .style("pointer-events","all")
                          .on("mouseover", function() { focus.style("display", null); })
                          .on("mouseout", function() { focus.style("display", "none"); })
                          .on("mousemove", mousemove);

                  // add the line groups
                  var stock = svg.selectAll(".stockXYZ")
                          .data(stocks)
                          .enter().append("g")
                          .attr("class","stockXYZ");

                  // add the stock price paths
                  stock.append("path")
                          .attr("class","line")
                          .attr("id",function(d,i){ return "id" + i; })
                          .attr("d", function(d) {
                            return line(d.values);
                          })
                          .style("stroke", function(d) { return color(d.name); });


                  // add the stock labels at the right edge of chart
                  var maxLen = data.length;
                  stock.append("text")
                          .datum(function(d) {
                            return {name: d.name, value: d.values[maxLen - 1]};
                          })
                          .attr("transform", function(d) {
                            return "translate(" + xScale(d.value.date) + "," + yScale(d.value.close) + ")";
                          })
                          .attr("id",function(d,i){ return "text_id" + i; })
                          .attr("x", 3)
                          .attr("dy", ".35em")
                          .text(function(d) { return d.name; })
                          .on("mouseover",function(d,i) {
                            for (j=0; j < 6; j++) {
                              if (i !== j) {
                                d3.select("#id"+j).style("opacity",0.1);
                                d3.select("#text_id"+j).style("opacity",0.2);
                              }
                            };
                          })
                          .on("mouseout", function(d,i) {
                            for (j=0; j < 6; j++) {
                              d3.select("#id"+j).style("opacity",1);
                              d3.select("#text_id"+j).style("opacity",1);
                            };
                          });

                  // mousemove function
                  function mousemove() {

                    var x0 = xScale.invert(d3.mouse(this)[0]);
                    var i = bisectDate(data, x0, 1); // gives index of element which has date higher than x0
                    var d0 = data[i - 1], d1 = data[i];
                    var d = x0 - d0.date > d1.date - x0 ? d1 : d0;
                    var close = d3.max([+d.Carbon_emission_trading,+d.Carbon_trade,+d.Payment_for_ecosystem_services,+d.Carbon_tax]);

                    focus.select("circle.y")
                            .attr("transform", "translate(" + xScale(d.date) + "," + yScale(close) + ")");

                    focus.select("line.y")
                            .attr("y2",height - yScale(close))
                            .attr("transform", "translate(" + xScale(d.date) + ","
                                    + yScale(close) + ")");

                    focus.select("line.x")
                            .attr("x2",xScale(d.date))
                            .attr("transform", "translate(0,"
                                    + (yScale(close)) + ")");

                  };

                });


      </script>
    </section>
    <section>
      <iframe src="index.html"></iframe>
    </section>


</body>
</html>

